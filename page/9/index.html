<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />





<meta name="description" content="MIS, Gamification, Education">
<meta property="og:type" content="website">
<meta property="og:title" content="Jack Xia">
<meta property="og:url" content="http://blog.toob.net.cn/page/9/index.html">
<meta property="og:site_name" content="Jack Xia">
<meta property="og:description" content="MIS, Gamification, Education">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Jack Xia">
<meta name="twitter:description" content="MIS, Gamification, Education">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://blog.toob.net.cn/page/9/"/>





  <title>Jack Xia</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jack Xia</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">笔记</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://blog.toob.net.cn/2017-07-05-OpenSource-Hexo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jack Xia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jack Xia">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017-07-05-OpenSource-Hexo/" itemprop="url">使用Hexo + Next搭建静态博客</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-05T08:00:00+08:00">
                2017-07-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>目的：</strong><br><a href="https://github.com/" target="_blank" rel="noopener">Github</a> + Hexo + Next + 域名搭建可自定义前端样式的免费博客</p>
<ul>
<li>超快速度： Node.js 所带来的超快生成速度，让上百个页面在几秒内瞬间完成渲染。</li>
<li>支持 Markdown： Hexo 支持 GitHub Flavored Markdown 的所有功能，甚至可以整合 Octopress 的大多数插件。</li>
<li>一键部署： 只需一条指令即可部署到 GitHub Pages, Heroku 或其他网站。</li>
<li>丰富的插件： Hexo 拥有强大的插件系统，安装插件可以让 Hexo 支持 Jade, CoffeeScript。</li>
</ul>
<p><strong>准备：</strong><br>GitHub账号申请<br>新建一个仓库（new repository），并命名为YourSiteName.github.io<br>用一键安装包安装nodejs环境 - <a href="http://nodejs.cn/download/" target="_blank" rel="noopener">http://nodejs.cn/download/</a><br>安装git工具 - <a href="https://git-scm.com/downloads" target="_blank" rel="noopener">https://git-scm.com/downloads</a></p>
<p><strong>部署:</strong></p>
<ol>
<li>使用npm安装hexo - 命令行$ npm install -g hexo-cli</li>
<li>初始化框架 - 命令行$ hexo init| cd| npm install</li>
<li>新建文章（创建一个Hello World） - 命令行$ hexo new “Hello World” (该命令在/source/_post里添加hello-world.md文件，之后新建的文章都将存放在此目录下。)</li>
<li>新建关于我等相关页面 - 命令行$ hexo new page “about” (该命令在/source/about里添加index.md文件)  </li>
<li>生成网站 命令行$ hexo generate 或者 $ hexo g (此时会将/source的.md文件生成到/public中，形成网站的静态文件。)</li>
<li>使用Next主题让站点更酷炫, 下载<a href="https://github.com/iissnan/hexo-theme-next" target="_blank" rel="noopener">https://github.com/iissnan/hexo-theme-next</a> 并放入项目根目录下的themes/next (可修改该模板中的内容或替换相关图片)</li>
<li>在source文件夹中新增CNAME,404.html等固定页面  </li>
<li>启用模板, 需要修改根目录/_config.yml配置项theme: next</li>
<li>验证是否启用 $ hexo s –debug, 如显示theme: next则为成功,默认是theme: landscape</li>
<li>Ctrl+C退出debug, 正常启动服务器 - 命令行$ hexo server 或者 $ hexo s (输入<a href="http://localhost:4000即可查看网站。" target="_blank" rel="noopener">http://localhost:4000即可查看网站。</a>)  </li>
<li>部署网站 - $ hexo deploy 或者 $ hexo d, 部署网站之前需要生成静态文件，即可以用$ hexo generate -d直接生成并部署。此时需要在_config.yml中配置你所要部署的站点：</li>
</ol>
<h2 id="Docs-http-hexo-io-docs-deployment-html"><a href="#Docs-http-hexo-io-docs-deployment-html" class="headerlink" title="Docs: http://hexo.io/docs/deployment.html"></a>Docs: <a href="http://hexo.io/docs/deployment.html" target="_blank" rel="noopener">http://hexo.io/docs/deployment.html</a></h2><p>deploy:<br>  type: git<br>       repo: git@github.com:YourRepository.git<br>       branch: master</p>
<p><strong>更多:</strong><br>Hexo配置参考: <a href="https://github.com/Jianfengxia/hexo-next-blog-fw/blob/master/_config.yml" target="_blank" rel="noopener">https://github.com/Jianfengxia/hexo-next-blog-fw/blob/master/_config.yml</a><br>Next配置参考: <a href="https://github.com/Jianfengxia/hexo-next-blog-fw/blob/master/themes/next/_config.yml" target="_blank" rel="noopener">https://github.com/Jianfengxia/hexo-next-blog-fw/blob/master/themes/next/_config.yml</a><br>404页面配置参考: <a href="https://github.com/Jianfengxia/hexo-next-blog-fw/blob/master/source/404.html" target="_blank" rel="noopener">https://github.com/Jianfengxia/hexo-next-blog-fw/blob/master/source/404.html</a><br>CNAME域名配置参考:<a href="https://github.com/Jianfengxia/hexo-next-blog-fw/blob/master/source/CNAME" target="_blank" rel="noopener">https://github.com/Jianfengxia/hexo-next-blog-fw/blob/master/source/CNAME</a><br>官网<a href="http://theme-next.iissnan.com/" target="_blank" rel="noopener">[Next]</a><br><a href="https://hexo.io/zh-cn/docs/configuration.html" target="_blank" rel="noopener">[Hexo | 配置]</a><br><a href="https://hexo.io/zh-cn/docs/commands.html" target="_blank" rel="noopener">[Hexo | 指令]</a><br><a href="http://theme-next.iissnan.com/theme-settings.html" target="_blank" rel="noopener">[Next | 主题设定]</a><br><a href="http://theme-next.iissnan.com/third-party-services.html" target="_blank" rel="noopener">[Next | 第三方服务]</a><br>那么到此为止网站的雏形算是完成了，接下来你就要自己去管理和完善个人网站了。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://blog.toob.net.cn/2017-07-04-OpenSource-SaltNote/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jack Xia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jack Xia">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017-07-04-OpenSource-SaltNote/" itemprop="url">slatstack注意点及解决方案</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-04T13:00:00+08:00">
                2017-07-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>研究slatstack时踩过的坑，注意点及解决方案<br>运行问题</p>
<p>1、直接物理性移除minion或者更换minion原先连接的master，会导致先前的master始终无法ping通minion</p>
<p>[root@localhost salt]# salt ‘*’ test.ping<br>minion_centos7:<br> True<br>win_minion:<br> True<br>10.1.240.193:<br> Minion did not return. [No response]<br>解决办法：在master上查看已接受的key</p>
<p>[root@localhost salt]# salt-key -L<br>Accepted Keys:<br>10.1.240.193<br>minion_centos7<br>win_minion<br>Denied Keys:<br>Unaccepted Keys:<br>Rejected Keys:<br>把删除的那台minion的key删除就好了</p>
<p>[root@localhost salt]# salt-key -d 10.1.240.193<br>其他汇总</p>
<p>1、minion安装的版本不同可能会导致master的部分请求解析失败，master同理</p>
<p>解决办法：查看minion的版本，升级或降级，务必统一版本</p>
<p>2、遇到一次同步后的grains为空白的情况，grains空白后导致整个minion连接异常，无论执行任何正常命令，报错都是minion无响应，与minion不在线的提示相同</p>
<p>不知什么原因，目前怀疑是与salt的modules命名相同或者是grains中有异常代码导致。前者还好处理，后者的话可能要加安全校验机制</p>
<p>解决办法：cd到/var/cache/salt/minion/extmods/grains/路径，把与modules同名的文件删除即可，不行的话清空整个目录内的文件</p>
<p>windows系统的解决办法差不多，找到安装目录下的grains存放位置，把异常的文件删除即可，比如我传来的grains是存放在C:\salt\var\cache\salt\minion\extmods\grains</p>
<p>3、saltstack模块内部出现错误时，salt内部抛出且不会回显，但是调用该模块时会出现问题，所以若模块调用正常，但写成api时结果不正常，有可能是模块的问题</p>
<p>4、minion上的防火墙服务firewalld开启可能会导致Minion did not return. [No response]</p>
<p>如果需要传参的话，最好不要用debug模式，因为-l debug这些字符可能传参处理时会引发异常从而导致运行失败</p>
<p>5、由于salt返回的一律是字典型，所以将输出写入文件时一定要转化为字符串，用str处理就好</p>
<p>6、可用**kwargs来接收不限数量的参数，但外部参数必须用kwargs[‘__pub_arg’][0]来获得，而且一旦不能转化为字典型就会报错</p>
<p>7、传送大文件时，有时返回成功，但是传送文件的目录里，文件名后面有个.part证明传输异常中断了</p>
<p>8、salt-master的ip有时会变，若配置文件没相应变更ip，重启salt时会提示[WARNING ] Unable to bind socket,<br>error: [Errno 99] Cannot assign requested</p>
<p>9、写grains时，grains的模块名字命名不可以与grains.item 的命名相同，否则只会输出none</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://blog.toob.net.cn/2017-07-04-OpenSource-SaltState/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jack Xia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jack Xia">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017-07-04-OpenSource-SaltState/" itemprop="url">Saltstack之state配置管理</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-04T09:00:00+08:00">
                2017-07-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="state模块简介"><a href="#state模块简介" class="headerlink" title="state模块简介"></a><strong>state模块简介</strong></h1><p><strong>state功能</strong><br>state是Saltstack最核心的功能，通过预先定制好的sls（salt state file）文件对被控制主机进行状态管理，支持包括程序包（pkg）、<br>文件（file）、网络配置（network）、系统服务（service）、系统用户（user）等。</p>
<p><strong>state的定义</strong><br>state是通过sls文件进行描述的，支持YAML语法，定义规则如下：</p>
<p> $ID: #定义state名称，通常采用与描述对象保存一致的方法，如apache、nginx等<br>$state: #须管理对象的类型</p>
<pre><code>- $state: states #定制对象的状态
</code></pre><p>ache: #state名称：apache<br>pkg: #管理对象类型：pkg，进行软件安装（yum、apt）<br> installed #pkg要执行的方法：install，如未安装就进行安装<br>      service: #管理对象类型：service，管理系统守护进程</p>
<pre><code>   - running #service要执行的方法：running，如未运行就进行启动
- require: #关键字require，确保apache服务只有在成功安装软件包后才会启动
  - pkg: apache
</code></pre><p>注：—关键字说明</p>
<pre><code>require：在运行此state之前，先运行依赖的state关系检查，可配置多个state依赖对象；
watch：在检查摸个state发生变化时运行此模块。
</code></pre><p><strong>state的使用</strong><br>state的入口文件与pillar一样，文件名都是top.sls，但state要求sls文件必须存放在Saltstack<br>base定义的目录下（默认为/srv/salt）。<br>state描述配置<em>.sls支持jinjia模板、grains及pillar引用等，在state的逻辑层次定义完成后，再通过salt ‘</em>‘<br>state.highstate执行生效。</p>
<p><em>结合grains与pillar，实现一个根据不同操作系统类型部署apache环境的任务*</em>  </p>
<p><strong>定义pillar</strong><br>【/srv/pillar/top.sls】</p>
<pre><code>base:
</code></pre><p>   ‘*’:</p>
<pre><code>- apache
</code></pre><p>ls中引用二级配置有两种方式，一种是直接引用，如本例中直接引用apache.sls；另一种是创建apache目录，再引用目录中的init.sls<br>果是一样的。</p>
<p>rv/pillar/apache.sls】或【/srv/pillar/apache/init.sls】</p>
<p> pkgs:<br> { % if grains[‘os_family’] == ‘Debian’ % }<br>      apache: apache2<br>      { % elif grains[‘os_family’] == ‘RedHat’ % }<br>      apache: httpd<br>      { % elif grains[‘os’] == ‘Arch’ % }<br>      apache: apache<br>    { % endif % }</p>
<pre><code>salt &apos;*&apos; saltutil.refresh_pillar #刷新pillar
salt &apos;*&apos; pillar.data pkgs #获取pkgs信息
</code></pre><p>ate**<br>salt/top.sls】</p>
<pre><code>base:
  &apos;*&apos;:
 - apache
</code></pre><p>【/srv/salt/apache.sls】或【/srv/salt/apache/init.sls】</p>
<pre><code>apache:
  pkg:
    - installed
    - name: {{ pillar['pkgs']['apache'] }} #pillar[&apos;pkgs&apos;][&apos;apache&apos;]引用的是pillar定义的数据
  service.running:
    - name: {{ pillar['pkgs']['apache'] }}
    - require:
      - pkg: {{ pillar['pkgs']['apache'] }}
</code></pre><p><strong>执行state</strong></p>
<pre><code>salt &apos;*&apos; state.highstate
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://blog.toob.net.cn/2017-07-03-Python-fabric/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jack Xia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jack Xia">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017-07-03-Python-fabric/" itemprop="url">fabric实现远程操作和部署 - Python自动化运维</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-03T08:00:00+08:00">
                2017-07-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>fabric模块是在paramiko基础上又做了一层封装，操作起来更方便。主要用于多台主机批量执行任务。Fabric用于简化使用SSH的应用程序部署或系统管<br>理任务。它提供的操作包括：执行本地或远程shell命令，上传/下载文件，以及其他辅助功能，如提示用户输入、中止执行等。与前几个包的比较:</p>
<p>paramiko：方便嵌套系统平台中，擅长远程执行命令，文件传输。</p>
<p>fabric：方便与shell脚本结合，擅长批量部署，任务管理。</p>
<p>pexpect：擅长自动交互，比如ssh、ftp、telnet。</p>
<ol>
<li>安装Pip &amp; Python 2.7 (or 3.6),并配置环境变量(默认安装会自动添加)</li>
<li>设置Notepad++作为IDE开发工具:运行中输入命令cmd /k python “$(FULL_CURRENT_PATH)” &amp; ECHO. &amp; PAUSE &amp; EXIT</li>
<li>安装第三方库: pip install fabric</li>
</ol>
<p>Examples:</p>
<p>```python </p>
<p> #!/usr/bin/env python</p>
<p> from fabric.api import *</p>
<p> from fabric.context_managers import *</p>
<p> from fabric.contrib.console import confirm</p>
<p>v.user=’root’</p>
<p> env.gateway=’192.168.1.23’</p>
<p> env.hosts=[‘192.168.1.21’,’192.168.1.22’]</p>
<p> env.passwords = {</p>
<pre><code>&apos;root@192.168.1.21:22&apos;: &apos;SKJh935yft#&apos;,
</code></pre><p>  ‘root@192.168.1.22:22’: ‘SKJh935yft#’,</p>
<p>  ‘root@192.168.1.23:22’: ‘KJSD9325hgs’</p>
<p> }</p>
<p>h=”/home/install/lnmp0.9.tar.gz”</p>
<p>/tmp/install”</p>
<p>ask</p>
<pre><code>def put_task():

    run(&quot;mkdir -p /tmp/install&quot;)

    with settings(warn_only=True):

        result = put(lpackpath, rpackpath)

    if result.failed and not confirm(&quot;put file failed, Continue[Y/N]?&quot;):

        abort(&quot;Aborting file put task!&quot;)



@task

def run_task():

    with cd(&quot;/tmp/install&quot;):

        run(&quot;tar -zxvf lnmp0.9.tar.gz&quot;)

        with cd(&quot;lnmp0.9/&quot;):

            run(&quot;./centos.sh&quot;)



@task

def go():

    put_task()

    run_task()
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://blog.toob.net.cn/2017-06-30-Python-paramiko/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jack Xia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jack Xia">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017-06-30-Python-paramiko/" itemprop="url">paramiko远程连接ssh2 - Python自动化运维</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-30T08:00:00+08:00">
                2017-06-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>paramiko是用python语言写的一个模块，遵循SSH2协议，支持以加密和认证的方式，进行远程服务器的连接。</p>
<p>由于使用的是python这样的能够跨平台运行的语言，所以所有python支持的平台，如Linux, Solaris, BSD, MacOS X,Windows等，paramiko都可以支持，因此，如果需要使用SSH从一个平台连接到另外一个平台，进行一系列的操作时，paramiko是最佳工具之一。  </p>
<ol>
<li>安装Pip &amp; Python 2.7 (or 3.6),并配置环境变量(默认安装会自动添加)</li>
<li>设置Notepad++作为IDE开发工具:运行中输入命令cmd /k python “$(FULL_CURRENT_PATH)” &amp; ECHO. &amp; PAUSE &amp; EXIT</li>
<li>安装第三方库: pip install paramiko</li>
</ol>
<p>Examples:</p>
<p>```python</p>
<h1 id="–-coding-utf-8-–"><a href="#–-coding-utf-8-–" class="headerlink" title="– coding: utf-8 –"></a>– coding: utf-8 –</h1><p> #!/usr/bin/env python</p>
<p> import paramiko</p>
<p> hostname=’10.1.134.128’</p>
<p> username=’username’</p>
<p> password=’password’</p>
<p> #paramiko.util.log_to_file(‘syslogin.log’)</p>
<pre><code>ssh=paramiko.SSHClient()

#ssh.load_system_host_keys()

ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())

ssh.connect(hostname=hostname,username=username,password=password)

stdin,stdout,stderr=ssh.exec_command(&apos;free -m&apos;)

print stdout.read()

ssh.close()
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://blog.toob.net.cn/2017-06-29-Python-pexpect/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jack Xia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jack Xia">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017-06-29-Python-pexpect/" itemprop="url">pexpect命令行交互(Linux Only) - Python自动化运维</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-29T08:00:00+08:00">
                2017-06-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Pexpect是一个纯Python模块,可以用来和ssh、ftp、passwd、telnet等命令行命令进行交互使用</p>
<ol>
<li>安装Pip &amp; Python 2.7 (or 3.6),并配置环境变量(默认安装会自动添加)</li>
<li>设置Notepad++作为IDE开发工具:运行中输入命令cmd /k python “$(FULL_CURRENT_PATH)” &amp; ECHO. &amp; PAUSE &amp; EXIT</li>
<li>安装第三方库: pip install pexpect</li>
</ol>
<p>Examples:</p>
<p>```python<br> from pexpect import pxssh</p>
<p> import getpass</p>
<p>y:</p>
<p>  s = pxssh.pxssh()</p>
<p>  hostname = raw_input(‘hostname: ‘)</p>
<p>  username = rawsername: ‘)</p>
<p>  password = getpass.getpass(‘password: ‘)</p>
<p>  s.login (hostname, username, password)</p>
<p>  s.sendline (‘uptime’)  # run a command</p>
<pre><code>s.prompt()             # match the prompt
</code></pre><p>  print s.before         # print everything before the prompt.</p>
<pre><code>    s.sendline (&apos;ls -l&apos;)

    s.prompt()

    print s.before

    s.sendline (&apos;df&apos;)

    s.prompt()

    print s.before

    s.logout()

except pxssh.ExceptionPxssh, e:

    print &quot;pxssh failed on login.&quot;

    print str(e)
</code></pre><p>Hacker Example: 用Pxssh暴力破解SSH密码:<a href="http://book.51cto.com/art/201601/504626.htm" target="_blank" rel="noopener">http://book.51cto.com/art/201601/504626.htm</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://blog.toob.net.cn/2017-06-28-Python-xlsx/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jack Xia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jack Xia">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017-06-28-Python-xlsx/" itemprop="url">xlsxWriter构造xlsx文件 - Python自动化运维</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-28T08:00:00+08:00">
                2017-06-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>xlsxWriter支持多种excle功能；与excel完美兼容；写大文件，速度快且只占用很小的内存空间, 不支持读或者改现有的excel文件</p>
<ol>
<li>安装Pip &amp; Python 2.7 (or 3.6),并配置环境变量(默认安装会自动添加)</li>
<li>设置Notepad++作为IDE开发工具:运行中输入命令cmd /k python “$(FULL_CURRENT_PATH)” &amp; ECHO. &amp; PAUSE &amp; EXIT</li>
<li>安装第三方库: pip install xlsxwriter</li>
</ol>
<p>Examples:</p>
<p>```python</p>
<p> #coding: utf-8</p>
<p> import xlsxwriter</p>
<p> workbook = xlsxwriter.Workbook(‘E:\python\pyauto\3\XlsxWriter\chart.xlsx’)</p>
<p> worksheet = workbook.add_worksheet()</p>
<p>art = workbook.add_chart({‘type’: ‘column’})</p>
<p>tle = [u’业务名称’,u’星期一’,u’星期二’,u’星期三’,u’星期四’,u’星期五’,u’星期六’,u’星期日’,u’平均流量’]</p>
<p> buname= [u’业务官网’,u’新闻中心’,u’购物频道’,u’体育频道’,u’亲子频道’]</p>
<p> data = [</p>
<pre><code>[150,152,158,149,155,145,148],

[89,88,95,93,98,100,99],

[201,200,198,175,170,198,195],

[75,77,78,78,74,70,79],

[88,85,87,90,93,88,84],
</code></pre><p> ]</p>
<p> format=workbook.add_format()</p>
<p> format.set_border(1)</p>
<p>rmat_title=workbook.add_format()</p>
<p>rmat_title.set_border(1)</p>
<p>itle.set_color(‘#cccccc’)</p>
<p>itle.set_align(‘center’)</p>
<p> format_title.set_bold()</p>
<p> format_ave=workbook.add_format()</p>
<p> format_ave.set_border(1)</p>
<p> format_ave.set_num_format(‘0.00’)</p>
<pre><code>worksheet.write_row(&apos;A1&apos;,title,format_title)

worksheet.write_column(&apos;A2&apos;, buname,format)

worksheet.write_row(&apos;B2&apos;, data[0],format)

worksheet.write_row(&apos;B3&apos;, data[1],format)

worksheet.write_row(&apos;B4&apos;, data[2],format)

worksheet.write_row(&apos;B5&apos;, data[3],format)

worksheet.write_row(&apos;B6&apos;, data[4],format)

# Insert an image.

worksheet.insert_image(&apos;B25&apos;, &apos;E:\\python\\pyauto\\3\\XlsxWriter\\img\\python-logo.png&apos;)



def chart_series(cur_row):

    worksheet.write_formula(&apos;I&apos;+cur_row, \

     &apos;=AVERAGE(B&apos;+cur_row+&apos;:H&apos;+cur_row+&apos;)&apos;,format_ave)

    chart.add_series({

        &apos;categories&apos;: &apos;=Sheet1!$B$1:$H$1&apos;,

        &apos;values&apos;:     &apos;=Sheet1!$B$&apos;+cur_row+&apos;:$H$&apos;+cur_row,

        &apos;line&apos;:       {&apos;color&apos;: &apos;black&apos;},

        &apos;name&apos;:    &apos;=Sheet1!$A$&apos;+cur_row,

    })



for row in range(2, 7):

    chart_series(str(row))



#chart.set_table()

#chart.set_style(30)

chart.set_size({&apos;width&apos;: 577, &apos;height&apos;: 287})

chart.set_title ({&apos;name&apos;: u&apos;业务流量周报图表&apos;})

chart.set_y_axis({&apos;name&apos;: &apos;Mb/s&apos;})



worksheet.insert_chart(&apos;A8&apos;, chart)

workbook.close()
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://blog.toob.net.cn/2017-06-27-Python-scapy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jack Xia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jack Xia">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017-06-27-Python-scapy/" itemprop="url">scapy交互式数据包处理 - Python自动化运维</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-27T08:00:00+08:00">
                2017-06-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>scapy是python写的一个功能强大的交互式数据包处理程序，可用来发送、嗅探、解析和伪造网络数据包，常常被用到网络攻击和测试中。它可以代替hping,arpspoof.ARP SK,arping,p0f,甚至是部分nmap,Tcpdump和tshark。</p>
<ol>
<li>安装Pip &amp; Python 2.7 (or 3.6),并配置环境变量(默认安装会自动添加)</li>
<li>设置Notepad++作为IDE开发工具:运行中输入命令cmd /k python “$(FULL_CURRENT_PATH)” &amp; ECHO. &amp; PAUSE &amp; EXIT</li>
<li>安装第三方库: pip install scapy</li>
</ol>
<p>Examples:</p>
<p>```python</p>
<h1 id="–-coding-utf-8-–"><a href="#–-coding-utf-8-–" class="headerlink" title="– coding: utf-8 –"></a>– coding: utf-8 –</h1><p> import os,sys,time,subprocess</p>
<p> import warnings,logging</p>
<p> warnings.filterwarnings(“ignore”, category=DeprecationWarning)</p>
<p> logging.getLogger(“scapy.runtime”).setLevel(logging.ERROR)</p>
<p>om scapy.all import traceroute</p>
<p>mains = raw_input(‘Please input one or more IP/domain: ‘)</p>
<p> target =  domains.split(‘ ‘)</p>
<pre><code>dport = [80]

if len(target) &gt;= 1 and target[0]!=&apos;&apos;:

    res,unans = traceroute(target,dport=dport,retry=-2)

    res.graph(target=&quot;&gt; test.svg&quot;)

    time.sleep(1)

    subprocess.Popen(&quot;/usr/bin/convert test.svg test.png&quot;, shell=True)

else:

    print &quot;IP/domain number of errors,exit&quot;
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://blog.toob.net.cn/2017-06-26-Python-rrdtool/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jack Xia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jack Xia">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017-06-26-Python-rrdtool/" itemprop="url">rrdtool绘制趋势图 - Python自动化运维</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-26T08:00:00+08:00">
                2017-06-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>rrdtool（round robin database）工具为环状数据库的存储格式，round robin是一种处理定量数据以及当前元素指针的技术。rrd<br>tool主要用来跟踪对象的变化情况，生成这些变化的走势图，比如业务的访问流量、系统性能、磁盘利用率等趋势图，很多流行监控平台都使用到rrdtool，比较有名<br>的为Cacti、Ganglia、Monitorix等。更多rrdtool介绍见官网<a href="http://oss.oetiker.ch/rrdtool/。rrdtoo" target="_blank" rel="noopener">http://oss.oetiker.ch/rrdtool/。rrdtoo</a><br>l是一个复杂的工具，涉及较多参数概念，本节主要通过Python的rrdtool模块对rrdtool的几个常用方法进行封装，包括create、fetch、gr<br>aph、info、update等方法，本节对rrdtool的基本知识不展开说明，重点放在Python rrdtool模块的常用方法使用介绍上。</p>
<ol>
<li>安装Pip &amp; Python 2.7 (or 3.6),并配置环境变量(默认安装会自动添加)</li>
<li>设置Notepad++作为IDE开发工具:运行中输入命令cmd /k python “$(FULL_CURRENT_PATH)” &amp; ECHO. &amp; PAUSE &amp; EXIT</li>
<li>安装第三方库: pip install rrdtool</li>
</ol>
<p>Examples:</p>
<p>第一步　采用create方法创建rrd数据库，参数指定了一个rrd文件、更新频率setp、起始时间–<br>start、数据源DS、数据源类型DST、数据周期定义RRA等，详细源码如下：【/root/xls/create.py】</p>
<p>```python</p>
<h1 id="–-coding-utf-8-–"><a href="#–-coding-utf-8-–" class="headerlink" title="– coding: utf-8 –"></a>– coding: utf-8 –</h1><p> #!/usr/bin/python  </p>
<p> import rrdtool  </p>
<p> import time  </p>
<p>r_time=str(int(time.time()))    #获取当前Linux时间戳作为rrd起始时间  </p>
<p> #数据写频率–step为300秒(即5分钟一个数据点)  </p>
<p>d=rrdtool.create(‘Flow.rrd’,’–step’,’300’,’–start’,cur_time,  </p>
<p>义数据源eth1_in(入流量)、eth1_out(出流量)；类型都为COUNTER(递增)；600秒为心跳值，  </p>
<p>含义是600秒没有收到值，则会用UNKNOWN代替；0为最小值；最大值用U代替，表示不确定  </p>
<p>‘DS:eth1_in:COUNTER:600:0:U’,  </p>
<p>‘DS:eth1_out:COUNTER:600:0:U’,  </p>
<p>#RRA定义格式为[RRA:CF:xff:steps:rows]，CF定义了AVERAGE、MAX、MIN三种数据合并方式  </p>
<p>#xff定义为0.5，表示一个CDP中的PDP值如超过一半值为UNKNOWN，则该CDP的值就被标为UNKNOWN  </p>
<p>#下列前4个RRA的定义说明如下，其他定义与AVERAGE方式相似，区别是存最大值与最小值  </p>
<h1 id="每隔5分钟-1-300秒-存一次数据的平均值-存600笔，即2-08天"><a href="#每隔5分钟-1-300秒-存一次数据的平均值-存600笔，即2-08天" class="headerlink" title="每隔5分钟(1*300秒)存一次数据的平均值,存600笔，即2.08天"></a>每隔5分钟(1*300秒)存一次数据的平均值,存600笔，即2.08天</h1><pre><code># 每隔30分钟(6*300秒)存一次数据的平均值,存700笔，即14.58天（2周）  

# 每隔2小时(24*300秒)存一次数据的平均值,存775笔，即64.58天（2个月）  

# 每隔24小时(288*300秒)存一次数据的平均值,存797笔，即797天(2年)  

&apos;RRA:AVERAGE:0.5:1:600&apos;,  

&apos;RRA:AVERAGE:0.5:6:700&apos;,  
</code></pre><p>   ‘RRA:AVERAGE:0.5:24:775’,  </p>
<p>   ‘RRA:AVERAGE:0.5:288:797’,  </p>
<p>   ‘RRA:MAX:0.5:1:600’,  </p>
<p>   ‘RRA:MAX:0.5:6:700’,  </p>
<p>   ‘RRA:MAX:0.5:24:775’,  </p>
<p>   ‘RRA:MAX:0.5:444:797’,  </p>
<p>   ‘RRA:MIN:0.5:1:600’,  </p>
<pre><code>&apos;RRA:MIN:0.5:6:700&apos;,  

&apos;RRA:MIN:0.5:24:775&apos;,  

&apos;RRA:MIN:0.5:444:797&apos;)  
</code></pre><p> if rrd:  </p>
<pre><code>print rrdtool.error()
</code></pre><p>　采用updatev方法更新rrd数据库，参数指定了当前的Linux时间戳，以及指定eth1_in、eth1_out值（当前网卡的出入流量），网卡流量<br>过psutil模块来获取，如psutil.network_io_counters()[1]为入流量，关于psutil模块的介绍见第1.1。详细源码如下<br>root/xls/update.py】</p>
<p>加入crontab，并配置5分钟作为采集频率，crontab配置如下：<em>/5 </em> <em> </em> * /usr/bin/python<br>ot/xls/update.py &gt; /dev/null 2&gt;&amp;1</p>
<h1 id="–-coding-utf-8-–-1"><a href="#–-coding-utf-8-–-1" class="headerlink" title="– coding: utf-8 –"></a>– coding: utf-8 –</h1><p> #!/usr/bin/python  </p>
<p> import rrdtool  </p>
<p> import time,psutil  </p>
<p> total_input_trwork_io_counters()[1]    #获取网卡入流量  </p>
<p> total_output_traffic = psutil.network_io_counters()[0] #获取网卡出流量  </p>
<p> starttime=int(time.time())    #获取当前Linux时间戳  </p>
<p> #将获取到的三个数据作为updatev的参数，返回{‘return_value’: 0L}则说明更新成功，反  </p>
<p> update=rrdtool.updatev(‘/root/xls/Flow.rrd’,’%s:%s:%s’ % r(starttime),str(total_input_traffic),str(total_output_traffic)))  </p>
<p> print update</p>
<p>第三步　采用graph方法绘制图表，此示例中关键参数使用了–x-grid定义X轴网格刻度；DEF指定数据源；使用CDEF合并数据；HRULE绘制水平线（告<br>警线）；GPRINT输出最大值、最小值、平均值等。详细源码如下：【/root/xls/graph.py】</p>
<pre><code># -- coding: utf-8 --

#!/usr/bin/python  

import rrdtool  

import time  

#定义图表上方大标题  

title=&quot;Server network  traffic flow (&quot;+time.strftime(&apos;%Y-%m-%d&apos;,time.localtime(time.time()))+&quot;)&quot;  

#重点解释&quot;--x-grid&quot;,&quot;MINUTE:12:HOUR:1:HOUR:1:0:%H&quot;参数的作用（从左往右进行分解）  

&quot;MINUTE:12&quot; #表示控制每隔12分钟放置一根次要格线  

&quot;HOUR:1&quot;  #表示控制每隔1小时放置一根主要格线  

&quot;HOUR:1&quot; # 表示控制1个小时输出一个label标签  

&quot;0:%H&quot;  #0表示数字对齐格线，%H表示标签以小时显示  

rrdtool.graph( &quot;Flow.png&quot;, &quot;--start&quot;, &quot;-1d&quot;,&quot;--vertical-label=Bytes/s&quot;,

&quot;--x-grid&quot;,&quot;MINUTE:12:HOUR:1:HOUR:1:0:%H&quot;,

 &quot;--width&quot;,&quot;650&quot;,&quot;--height&quot;,&quot;230&quot;,&quot;--title&quot;,title,  

 &quot;DEF:inoctets=Flow.rrd:eth1_in:AVERAGE&quot;,    #指定网卡入流量数据源DS及CF  

 &quot;DEF:outoctets=Flow.rrd:eth1_out:AVERAGE&quot;,    #指定网卡出流量数据源DS及CF  

 &quot;CDEF:total=inoctets,outoctets,+&quot;,    #通过CDEF合并网卡出入流量，得出总流量total  



&quot;LINE1:total#FF8833:Total traffic&quot;,    #以线条方式绘制总流量  

 &quot;AREA:inoctets#00FF00:In traffic&quot;,    #以面积方式绘制入流量  

 &quot;LINE1:outoctets#0000FF:Out traffic&quot;,    #以线条方式绘制出流量  

 &quot;HRULE:6144#FF0000:Alarm value\\r&quot;,    #绘制水平线，作为告警线，阈值为6.1k  

 &quot;CDEF:inbits=inoctets,8,*&quot;,    #将入流量换算成bit，即*8，计算结果给inbits  

 &quot;CDEF:outbits=outoctets,8,*&quot;,    #将出流量换算成bit，即*8，计算结果给outbits  

&quot;COMMENT:\\r&quot;,                    #在网格下方输出一个换行符  

 &quot;COMMENT:\\r&quot;,  

 &quot;GPRINT:inbits:AVERAGE:Avg In traffic\: %6.2lf %Sbps&quot;,    #绘制入流量平均值  

 &quot;COMMENT:   &quot;,  

 &quot;GPRINT:inbits:MAX:Max In traffic\: %6.2lf %Sbps&quot;,    #绘制入流量最大值  

 &quot;COMMENT:  &quot;,  

 &quot;GPRINT:inbits:MIN:MIN In traffic\: %6.2lf %Sbps\\r&quot;,    #绘制入流量最小值  

 &quot;COMMENT: &quot;,  

 &quot;GPRINT:outbits:AVERAGE:Avg Out traffic\: %6.2lf %Sbps&quot;,    #绘制出流量平均值  

 &quot;COMMENT: &quot;,  

 &quot;GPRINT:outbits:MAX:Max Out traffic\: %6.2lf %Sbps&quot;,    #绘制出流量最大值  

 &quot;COMMENT: &quot;,  

 &quot;GPRINT:outbits:MIN:MIN Out traffic\: %6.2lf %Sbps\\r&quot;)    #绘制出流量最小值
</code></pre><p>以上代码将生成一个Flow.png文件</p>
<p>查看rrd文件内容有利于观察数据的结构、更新等情况，rrdtool提供几个常用命令：</p>
<p>info查看rrd文件的结构信息，如rrdtool info Flow.rrd；</p>
<p>first查看rrd文件第一个数据的更新时间，如rrdtool first Flow.rrd；</p>
<p>last查看rrd文件最近一次更新的时间，如rrdtool last Flow.rrd；</p>
<p>fetch根据指定时间、CF查询rrd文件，如rrdtool fetch Flow.rrd AVERAGE （必须为大写）</p>
<p><strong>rrdtool参数说明</strong>: <a href="http://bbs.chinaunix.net/thread-2150417-1-1.html和http://oss.oetiker.ch/rrdtool/doc/index.en.html。" target="_blank" rel="noopener">http://bbs.chinaunix.net/thread-2150417-1-1.html和http://oss.oetiker.ch/rrdtool/doc/index.en.html。</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://blog.toob.net.cn/2017-06-23-Python-smtplib/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jack Xia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jack Xia">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017-06-23-Python-smtplib/" itemprop="url">smtplib发送邮件 - Python自动化运维</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-23T08:00:00+08:00">
                2017-06-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li>安装Pip &amp; Python 2.7 (or 3.6),并配置环境变量(默认安装会自动添加)</li>
<li>设置Notepad++作为IDE开发工具:运行中输入命令cmd /k python “$(FULL_CURRENT_PATH)” &amp; ECHO. &amp; PAUSE &amp; EXIT</li>
<li>安装第三方库: pip install smtplib</li>
</ol>
<p>Examples:</p>
<p>```python</p>
<h1 id="–-coding-utf-8-–"><a href="#–-coding-utf-8-–" class="headerlink" title="– coding: utf-8 –"></a>– coding: utf-8 –</h1><p> import smtplib</p>
<p> from email.mime.multipart import MIMEMultipart</p>
<p> from email.mime.text import MIMEText</p>
<p> from email.mime.image import MIMEImage</p>
<p> HOST = “m.xxx.com”</p>
<p> TO = “jianfeng.xia@xxx.com”</p>
<p> EmailUser = “Task.system”</p>
<p> EmailPass = “gta@2017”</p>
<p> FROM = “Task.system@xxx.com”</p>
<p>BJECT = u”官网业务服务质量周报”</p>
<p> def addimg(src,imgid):</p>
<pre><code>    fp = open(src, &apos;rb&apos;)


    msgImage = MIMEImage(fp.read())


    fp.close()


    msgImage.add_header(&apos;Content-ID&apos;, imgid)


    return msgImage





msg = MIMEMultipart(&apos;related&apos;)


msgtext = MIMEText(&quot;&lt;font color=red&gt;官网业务周平均延时图表:&lt;br&gt;&lt;img src=\&quot;cid:weekly\&quot; border=\&quot;1\&quot;&gt;&lt;br&gt;详细内容见附件。&lt;/font&gt;&quot;,&quot;html&quot;,&quot;utf-8&quot;)


msg.attach(msgtext)


#msg.attach(addimg(&quot;img/weekly.png&quot;,&quot;weekly&quot;))





#attach = MIMEText(open(&quot;doc/week_report.xlsx&quot;, &quot;rb&quot;).read(), &quot;base64&quot;, &quot;utf-8&quot;)


#attach[&quot;Content-Type&quot;] = &quot;application/octet-stream&quot;


#attach[&quot;Content-Disposition&quot;] = &quot;attachment; filename=\&quot;业务服务质量周报(12周).xlsx\&quot;&quot;.decode(&quot;utf-8&quot;).encode(&quot;gb18030&quot;)


#msg.attach(attach)





msg[&apos;Subject&apos;] = SUBJECT


msg[&apos;From&apos;]=FROM


msg[&apos;To&apos;]=TO


try:


    server = smtplib.SMTP()


    server.connect(HOST,&quot;587&quot;)


    server.starttls()


    server.login(EmailUser, EmailPass)


    server.sendmail(FROM, TO, msg.as_string())


    server.quit()


    print &quot;邮件发送成功！&quot;


except Exception, e:  


    print &quot;失败：&quot;+str(e)
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/8/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" href="/page/10/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Jack Xia" />
          <p class="site-author-name" itemprop="name">Jack Xia</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">149</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">23</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jack Xia</span>
</div>



        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>

<script type="text/javascript" src="//cdn.bootcss.com/mermaid/6.0.0/mermaid.min.js"></script>

  


  




	





  





  





  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

</body>
</html>
